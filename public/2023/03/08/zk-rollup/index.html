<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="naughty dog">


    <meta name="subtitle" content="个人空间">


    <meta name="description" content="测试">


    <meta name="keywords" content="blog">


<title>zk-rollup | naughty dog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 6.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Naughty Dog&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">文章</a>
                
                    <a class="menu-item" href="/category">目录</a>
                
                    <a class="menu-item" href="/tag">标签</a>
                
                    <a class="menu-item" href="/about">关于</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Naughty Dog&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">文章</a>
                
                    <a class="menu-item" href="/category">目录</a>
                
                    <a class="menu-item" href="/tag">标签</a>
                
                    <a class="menu-item" href="/about">关于</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">展开全部</a>
        <a onclick="go_top()">回到顶部</a>
        <a onclick="go_bottom()">回到底部</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? '展开全部' : '折叠';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>

    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">zk-rollup</h1>
            
                <div class="post-meta">
                    
                        作者: <a itemprop="author" rel="author" href="/">naughty dog</a>
                    

                    
                        <span class="post-time">
                        发布时间: <a href="#">2023-03-08&nbsp;&nbsp;17:07:22</a>
                        </span>
                    
                    
                        <span class="post-category">
                    目录:
                            
                                <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="zkRollup：以太坊扩容新方案"><a href="#zkRollup：以太坊扩容新方案" class="headerlink" title="zkRollup：以太坊扩容新方案"></a>zkRollup：以太坊扩容新方案</h1><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>以太坊是当前全球最大的智能合约平台，它拥有着大量的用户和开发者，但同时也存在着一些问题，例如：网络拥堵、交易费用过高等。为了解决这些问题，以太坊社区提出了很多方案，其中 zkRollup（Zero-Knowledge Rollup）是其中的一种，它是一种新的扩容方案，可以在不牺牲去中心化和安全性的前提下提高以太坊的吞吐量，本文将详细介绍 zkRollup 的原理和优缺点。</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>随着区块链技术的不断发展，越来越多的项目开始关注区块链的可扩展性问题。由于以太坊的 TPS（每秒交易数）仅为 15 左右，无法满足大规模商用应用的需求，因此 Layer 2 技术开始成为了研究的热点。</p>
<p>Layer 2 技术可以将一部分交易从区块链的主链上转移到链上的第二层，从而减少主链的负载，提高整个系统的性能。常见的 Layer 2 技术包括状态通道（State Channels）、Plasma、Sidechain 等。</p>
<p>然而，这些技术中的大部分都需要信任第三方，容易被攻击。为了解决这一问题，一种名为 ZK-Rollup 的技术应运而生。</p>
<h2 id="传统扩容方案"><a href="#传统扩容方案" class="headerlink" title="传统扩容方案"></a>传统扩容方案</h2><p>在介绍 zkRollup 前，我们先来看看传统的以太坊扩容方案，主要有以下几种：</p>
<h3 id="1-分片技术"><a href="#1-分片技术" class="headerlink" title="1. 分片技术"></a>1. 分片技术</h3><p>分片技术是当前以太坊正在积极研究的方案之一，它的核心思想是将整个以太坊网络分成多个小网络，每个小网络独立处理交易，这样就可以大大提高网络的吞吐量。分片技术有很多优点，例如：它可以不影响以太坊的去中心化和安全性，同时也可以降低交易费用，提高处理速度等。但分片技术也存在着一些问题，例如：难以实现跨片交易，容易出现“碎片化”的情况等。</p>
<h3 id="2-Plasma-技术"><a href="#2-Plasma-技术" class="headerlink" title="2. Plasma 技术"></a>2. Plasma 技术</h3><p>Plasma 技术是一种以太坊扩容方案，它的核心思想是将一些交易放到侧链中进行处理，这样可以大大提高以太坊的吞吐量，同时也可以降低交易费用。Plasma 技术也有很多优点，例如：它可以降低交易费用，提高处理速度，同时还可以保持去中心化和安全性等。但 Plasma 技术也存在着一些问题，例如：容易出现链下交易问题，安全性难以保证等。</p>
<h2 id="ZK-Rollup-的基本思想"><a href="#ZK-Rollup-的基本思想" class="headerlink" title="ZK-Rollup 的基本思想"></a>ZK-Rollup 的基本思想</h2><p>ZK-Rollup 的基本思想是将所有的交易放在链上的第二层中进行处理，而不是直接放在主链上。同时，为了避免第二层出现不一致的情况，ZK-Rollup 使用了零知识证明来确保每个交易都是有效的。</p>
<p>在 ZK-Rollup 中，每个区块都包含了大量的交易信息。这些交易信息被打包成一个 Merkle 树，并生成对应的零知识证明。这个证明能够证明这个 Merkle 树中的某些交易是有效的。</p>
<p>在新的区块生成之前，会先对当前区块进行验证。这个验证过程包括两部分：</p>
<ol>
<li><p>验证交易的合法性：对于 Merkle 树中的每个交易，都需要进行验证，确保其符合所有的交易规则（例如，交易双方的签名是有效的、交易的金额不为负数等等）。</p>
</li>
<li><p>验证零知识证明的正确性：如果交易合法，则需要对 Merkle 树生成的零知识证明进行验证，确保它是正确的。</p>
</li>
</ol>
<p>验证通过之后，新的区块就会被添加到链上。</p>
<h2 id="zkRollup-的原理"><a href="#zkRollup-的原理" class="headerlink" title="zkRollup 的原理"></a>zkRollup 的原理</h2><p>zkRollup 是一个采用零知识证明实现的二层扩容方案，它通过将交易数据存储在链下的状态树中，实现了在链上仅记录状态树根哈希值的方式，从而在保证安全性的同时大幅提升了交易吞吐量。</p>
<p>具体来说，zkRollup 的实现原理如下：</p>
<h3 id="1-状态树"><a href="#1-状态树" class="headerlink" title="1. 状态树"></a>1. 状态树</h3><p>zkRollup 使用状态树来存储交易数据，每个叶节点表示一个账户，每个内部节点表示一个状态集合，每个状态集合包含其所有子节点所代表账户的状态的哈希值。</p>
<h3 id="2-交易提交"><a href="#2-交易提交" class="headerlink" title="2. 交易提交"></a>2. 交易提交</h3><p>当用户发起一笔交易时，zkRollup 需要进行以下操作：</p>
<ol>
<li>检查交易的合法性。</li>
<li>从状态树中读取与交易相关的账户状态。</li>
<li>计算出交易后账户状态的哈希值。</li>
<li>将交易打包成一个交易证明，交易证明包含交易本身以及新的状态哈希值。</li>
<li>将交易证明提交到以太坊网络，zkRollup 合约接收到交易证明后，更新状态树。</li>
</ol>
<h3 id="3-状态验证"><a href="#3-状态验证" class="headerlink" title="3. 状态验证"></a>3. 状态验证</h3><p>zkRollup 的状态验证是通过零知识证明实现的。zkRollup 中的每一个状态集合都对应一个零知识证明，证明该状态集合中所有账户状态的正确性。这个证明可以被用来验证状态树中任何一个状态是否合法。</p>
<h3 id="4-合约操作"><a href="#4-合约操作" class="headerlink" title="4. 合约操作"></a>4. 合约操作</h3><p>zkRollup 的合约操作主要包括以下三种：</p>
<ol>
<li>Deposit：用户将以太币存入 zkRollup 合约，合约会生成一份对应的状态证明，并在状态树中新增一个叶子节点。</li>
<li>Withdraw：用户提取存入合约的以太币，合约会验证用户的提现请求，然后删除状态树中对应的叶子节点，并生成一份对应的状态证明。</li>
<li>Transfer：用户在不同账户之间进行转账操作，合约会验证转账请求的合法性，并更新状态树中相关账户的状态。</li>
</ol>
<h3 id="5-优势与劣势"><a href="#5-优势与劣势" class="headerlink" title="5. 优势与劣势"></a>5. 优势与劣势</h3><p>zkRollup 的主要优势在于能够大幅提升以太坊的交易吞吐量，同时保证了链上交易的安全性。与此同时，zkRollup 的缺点在于需要使用零知识证明来实现状态验证，这导致了 zkRollup 的实现难度和成本较高。</p>

        </div>

        
        <section class="post-tags">
            <div>
                <span>标签:</span>
                <span class="tag">
                    
                    
                        <a href="/tags/layer2/"># layer2</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">上一页</a>
                <span>· </span>
                <a href="/">首页</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2023/03/13/visual-chatgpt/">visual-chatgpt</a>
            
            
            <a class="next" rel="next" href="/2023/03/08/raft/">raft</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© naughty dog | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>